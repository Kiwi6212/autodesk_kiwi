<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="AutoDesk Kiwi - Hub personnel de productivit√©">
  <title>AutoDesk Kiwi - Productivit√©</title>

  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6366f1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Kiwi">

  
  <link rel="stylesheet" href="style.css">


  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body x-data="app()" x-init="init()">

  
  <div class="toast-container">
    <template x-for="toast in toasts" :key="toast.id">
      <div class="toast" :class="toast.type" x-show="toast.show" x-transition>
        <span class="toast-icon" x-text="toast.icon"></span>
        <span class="toast-message" x-text="toast.message"></span>
        <button class="toast-close" @click="removeToast(toast.id)">√ó</button>
      </div>
    </template>
  </div>

  
  <header class="topbar">
    <h1 @click="currentView = 'today'" style="cursor: pointer;">AutoDesk Kiwi</h1>
    <nav class="tabs">
      <button class="tab" :class="{ active: currentView === 'today' }" @click="currentView = 'today'">
        Aujourd'hui
      </button>
      <button class="tab" :class="{ active: currentView === 'tasks' }" @click="currentView = 'tasks'">
        T√¢ches
      </button>
      <button class="tab" :class="{ active: currentView === 'weather' }" @click="currentView = 'weather'">
        M√©t√©o
      </button>
      <button class="tab" :class="{ active: currentView === 'hyperplanning' }" @click="currentView = 'hyperplanning'">
        Hyperplanning
      </button>
      <button class="tab" :class="{ active: currentView === 'mail' }" @click="currentView = 'mail'">
        Mail
      </button>
      <button class="tab" :class="{ active: currentView === 'analytics' }" @click="currentView = 'analytics'; loadAnalytics()">
        Stats
      </button>
      <button class="tab" :class="{ active: currentView === 'settings' }" @click="currentView = 'settings'">
        Param√®tres
      </button>
      <button class="tab theme-toggle" @click="showShortcutsHelp = true" title="Raccourcis clavier (?)">
        ‚å®Ô∏è
      </button>
      <button class="tab theme-toggle" @click="toggleFocusMode()" :class="{ active: focusMode }" title="Mode Focus">
        üéØ
      </button>
      <button class="tab theme-toggle" @click="toggleTheme()" :title="theme === 'auto' ? 'Mode: Auto (syst√®me)' : theme === 'dark' ? 'Mode: Sombre' : 'Mode: Clair'">
        <span x-text="getThemeIcon()"></span>
      </button>

      <div class="auth-nav">
        <template x-if="auth.isAuthenticated">
          <div class="user-menu">
            <span class="user-badge"><span x-text="auth.user?.username"></span></span>
            <button class="btn btn-sm" @click="logout()" title="D√©connexion">Logout</button>
          </div>
        </template>
        <template x-if="!auth.isAuthenticated">
          <button class="btn btn-primary btn-sm" @click="auth.showLogin = true">Connexion</button>
        </template>
      </div>
    </nav>
  </header>

  <div x-show="auth.showLogin || auth.showRegister" class="modal-overlay" @click.self="auth.showLogin = false; auth.showRegister = false">
    <div class="modal auth-modal">
      <div class="modal-header">
        <h3 x-text="auth.showRegister ? 'Cr√©er un compte' : 'Connexion'"></h3>
        <button @click="auth.showLogin = false; auth.showRegister = false" class="btn" style="padding: 5px 10px;">‚úï</button>
      </div>

      <template x-if="auth.showLogin && !auth.showRegister">
        <form @submit.prevent="login()" class="modal-body auth-form">
          <div class="form-group">
            <label>Nom d'utilisateur</label>
            <input type="text" x-model="auth.loginForm.username" required autocomplete="username" />
          </div>
          <div class="form-group">
            <label>Mot de passe</label>
            <input type="password" x-model="auth.loginForm.password" required autocomplete="current-password" />
          </div>
          <div x-show="auth.error" class="auth-error" x-text="auth.error"></div>
          <div class="modal-actions">
            <button type="submit" class="primary">Se connecter</button>
          </div>
          <p class="auth-switch">
            Pas encore de compte ?
            <a href="#" @click.prevent="auth.showRegister = true; auth.showLogin = false; auth.error = ''">Cr√©er un compte</a>
          </p>
        </form>
      </template>

      <template x-if="auth.showRegister">
        <form @submit.prevent="register()" class="modal-body auth-form">
          <div class="form-group">
            <label>Nom d'utilisateur</label>
            <input type="text" x-model="auth.registerForm.username" required pattern="^[a-zA-Z0-9_]+$" minlength="3" maxlength="50" autocomplete="username" />
            <small>3-50 caract√®res, lettres, chiffres et underscore uniquement</small>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" x-model="auth.registerForm.email" required autocomplete="email" />
          </div>
          <div class="form-group">
            <label>Mot de passe</label>
            <input type="password" x-model="auth.registerForm.password" required minlength="8" autocomplete="new-password" />
            <small>Minimum 8 caract√®res</small>
          </div>
          <div class="form-group">
            <label>Confirmer le mot de passe</label>
            <input type="password" x-model="auth.registerForm.confirmPassword" required autocomplete="new-password" />
          </div>
          <div x-show="auth.error" class="auth-error" x-text="auth.error"></div>
          <div class="modal-actions">
            <button type="submit" class="primary">Cr√©er le compte</button>
          </div>
          <p class="auth-switch">
            D√©j√† un compte ?
            <a href="#" @click.prevent="auth.showLogin = true; auth.showRegister = false; auth.error = ''">Se connecter</a>
          </p>
        </form>
      </template>
    </div>
  </div>

  <div x-show="showShortcutsHelp" class="modal-overlay" @click.self="showShortcutsHelp = false" x-transition>
    <div class="modal shortcuts-modal">
      <div class="modal-header">
        <h3>Raccourcis clavier</h3>
        <button @click="showShortcutsHelp = false" class="btn" style="padding: 5px 10px;">‚úï</button>
      </div>
      <div class="modal-body shortcuts-body">
        <div class="shortcuts-section">
          <h4>Navigation</h4>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>1</kbd><span>Aujourd'hui</span></div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>2</kbd><span>Taches</span></div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>3</kbd><span>Meteo</span></div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>4</kbd><span>Hyperplanning</span></div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>5</kbd><span>Mail</span></div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>6</kbd><span>Parametres</span></div>
        </div>
        <div class="shortcuts-section">
          <h4>Actions</h4>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>N</kbd><span>Nouvelle tache</span></div>
          <div class="shortcut-row"><kbd>T</kbd><span>Changer le theme</span></div>
          <div class="shortcut-row"><kbd>?</kbd><span>Afficher cette aide</span></div>
          <div class="shortcut-row"><kbd>Echap</kbd><span>Fermer / Deselectionner</span></div>
        </div>
      </div>
    </div>
  </div>

  <main>


    <section x-show="currentView === 'today'" x-transition:enter="view-enter" x-transition:leave="view-leave" class="view">
      <h2>R√©sum√© du jour</h2>

      
      <div class="today-widgets">
        
        <div class="clock-widget">
          <div class="clock-time" x-text="clock.time"></div>
          <div class="clock-date" x-text="clock.date"></div>
        </div>

        
        <div class="pomodoro-widget" :class="pomodoro.mode">
          <div class="pomodoro-label" x-text="getPomodoroLabel()"></div>
          <div class="pomodoro-time" x-text="formatPomodoro()"></div>
          <div class="pomodoro-controls">
            <button x-show="!pomodoro.isRunning" @click="startPomodoro()" class="primary">‚ñ∂Ô∏è Start</button>
            <button x-show="pomodoro.isRunning" @click="pausePomodoro()" class="btn">‚è∏Ô∏è Pause</button>
            <button @click="resetPomodoro()" class="btn">üîÑ</button>
            <button @click="skipPomodoro()" class="btn" title="Passer">‚è≠Ô∏è</button>
          </div>
          <div class="pomodoro-count">
            <span x-text="pomodoro.completedPomodoros"></span> pomodoro(s)
          </div>
        </div>
      </div>

      <div class="card quote-card" x-show="overview.quote && !focusMode">
        <div class="quote-content">
          <p class="quote-text">"<span x-text="overview.quote"></span>"</p>
          <p class="quote-author" x-show="overview.quote_author">‚Äî <span x-text="overview.quote_author"></span></p>
        </div>
        <button class="btn-icon refresh-quote" @click="refreshQuote()" title="Nouvelle citation">üîÑ</button>
      </div>

      <div class="card" x-show="!focusMode && (hyperplanning.nextCourses.length || weather.current.temp || email.count !== null)">
        <p x-show="hyperplanning.nextCourses.length"><strong>Prochain cours:</strong>
          <span x-text="hyperplanning.nextCourses[0]?.subject"></span> √†
          <span x-text="hyperplanning.nextCourses[0]?.start"></span>
          <span x-show="hyperplanning.nextCourses[0]?.room">(<span x-text="hyperplanning.nextCourses[0]?.room"></span>)</span>
        </p>
        <p x-show="weather.current.temp"><strong>M√©t√©o <span x-text="weather.location"></span>:</strong> 
          <span x-text="Math.round(weather.current.temp)"></span>¬∞C - 
          <span x-text="getWeatherDesc(weather.current.weathercode)"></span>
        </p>
        <p x-show="email.count !== null"><strong>Proton Mail:</strong>
          <span x-text="email.count"></span> non lu(s)
          <span x-show="email.error" style="color: var(--danger);">(<span x-text="email.error"></span>)</span>
        </p>
      </div>

      
      <div x-show="!focusMode">
      <h3>Notes rapides</h3>
      <div class="card quick-notes-card">
        <textarea
          class="quick-notes-textarea"
          x-model="quickNotes"
          @input="saveQuickNotes()"
          placeholder="√âcrivez vos notes ici..."
        ></textarea>
      </div>
      </div>

      <div x-show="!focusMode">
      <h3>Liens favoris <button class="btn-icon" @click="showAddLink = !showAddLink" title="Ajouter un lien">‚ûï</button></h3>
      <div class="card favorite-links-card">
        
        <div class="add-link-form" x-show="showAddLink" x-transition>
          <input type="text" x-model="newLink.name" placeholder="Nom du lien" class="input-field">
          <input type="url" x-model="newLink.url" placeholder="https://..." class="input-field" @keyup.enter="addFavoriteLink()">
          <button class="btn btn-primary" @click="addFavoriteLink()">Ajouter</button>
        </div>
        
        <div class="links-list" x-show="favoriteLinks.length">
          <template x-for="link in favoriteLinks" :key="link.id">
            <div class="link-item">
              <a :href="link.url" target="_blank" rel="noopener" x-text="link.name"></a>
              <button class="btn-icon remove-link" @click="removeFavoriteLink(link.id)" title="Supprimer">‚úï</button>
            </div>
          </template>
        </div>
        <p x-show="!favoriteLinks.length && !showAddLink" class="empty-links">Aucun lien favori. Cliquez sur ‚ûï pour en ajouter.</p>
      </div>
      </div>

      <div x-show="!focusMode">
      <h3>Compte √† rebours <button class="btn-icon" @click="showAddCountdown = !showAddCountdown" title="Ajouter un √©v√©nement">‚ûï</button></h3>
      <div class="card countdowns-card">
        
        <div class="add-countdown-form" x-show="showAddCountdown" x-transition>
          <input type="text" x-model="newCountdown.name" placeholder="Nom de l'√©v√©nement" class="input-field">
          <input type="date" x-model="newCountdown.date" class="input-field">
          <button class="btn btn-primary" @click="addCountdown()">Ajouter</button>
        </div>
        
        <div class="countdowns-list" x-show="countdowns.length">
          <template x-for="countdown in countdowns" :key="countdown.id">
            <div class="countdown-item" :class="{ 'passed': getDaysRemaining(countdown.date) < 0 }">
              <div class="countdown-info">
                <span class="countdown-name" x-text="countdown.name"></span>
                <span class="countdown-date" x-text="formatCountdownDate(countdown.date)"></span>
              </div>
              <div class="countdown-days">
                <span class="days-number" x-text="Math.abs(getDaysRemaining(countdown.date))"></span>
                <span class="days-label" x-text="getDaysRemaining(countdown.date) >= 0 ? 'jours restants' : 'jours pass√©s'"></span>
              </div>
              <button class="btn-icon remove-countdown" @click="removeCountdown(countdown.id)" title="Supprimer">‚úï</button>
            </div>
          </template>
        </div>
        <p x-show="!countdowns.length && !showAddCountdown" class="empty-countdowns">Aucun compte √† rebours. Cliquez sur ‚ûï pour en ajouter.</p>
      </div>
      </div>

      <div class="card lofi-card">
        <div class="lofi-header" @click="toggleLofiPlayer()">
          <h4 style="margin: 0;">Lofi Hip Hop Radio</h4>
          <span class="lofi-toggle" x-text="lofiPlayer.show ? '‚ñº' : '‚ñ∂'"></span>
        </div>
        <div class="lofi-player" x-show="lofiPlayer.show" x-transition>
          <iframe
            width="100%"
            height="200"
            src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=0"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
          </iframe>
          <p class="lofi-credit">Lofi Girl - beats to relax/study to</p>
        </div>
      </div>

      <div x-show="!focusMode">
      <h3>Statistiques des t√¢ches</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" x-text="stats.total || 0"></div>
          <div class="stat-label">Total</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" x-text="stats.by_status?.todo || 0"></div>
          <div class="stat-label">√Ä faire</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" x-text="stats.by_status?.doing || 0"></div>
          <div class="stat-label">En cours</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" x-text="stats.by_status?.done || 0"></div>
          <div class="stat-label">Termin√©es</div>
        </div>
      </div>
      </div>

      <div x-show="!focusMode">
      <h3>Progression</h3>
      <div class="card gamification-card">
        <div class="gamification-header">
          <div class="level-info">
            <span class="level-icon" x-text="getCurrentLevel().icon"></span>
            <div class="level-details">
              <span class="level-name">Niveau <span x-text="getCurrentLevel().level"></span> - <span x-text="getCurrentLevel().name"></span></span>
              <div class="xp-bar">
                <div class="xp-fill" :style="`width: ${getLevelProgress()}%`"></div>
              </div>
              <span class="xp-text"><span x-text="gamification.xp"></span> XP</span>
            </div>
          </div>
          <div class="streak-info">
            <span class="streak-fire">üî•</span>
            <span class="streak-count" x-text="gamification.streak"></span>
            <span class="streak-label">jours</span>
          </div>
        </div>

        <div class="gamification-stats">
          <div class="gam-stat">
            <span class="gam-stat-value" x-text="gamification.totalTasksCompleted"></span>
            <span class="gam-stat-label">T√¢ches</span>
          </div>
          <div class="gam-stat">
            <span class="gam-stat-value" x-text="gamification.totalPomodorosCompleted"></span>
            <span class="gam-stat-label">Pomodoros</span>
          </div>
          <div class="gam-stat">
            <span class="gam-stat-value" x-text="gamification.unlockedBadges.length"></span>
            <span class="gam-stat-label">Badges</span>
          </div>
        </div>

        <div class="badges-section">
          <h4>Badges</h4>
          <div class="badges-grid">
            <template x-for="badge in badges" :key="badge.id">
              <div class="badge-item" :class="{ 'unlocked': isBadgeUnlocked(badge.id) }" :title="badge.desc">
                <span class="badge-icon" x-text="badge.icon"></span>
                <span class="badge-name" x-text="badge.name"></span>
              </div>
            </template>
          </div>
        </div>
      </div>
      </div>

      <div x-show="!focusMode">
      <h3>Habitudes <button class="btn-icon" @click="showAddHabit = !showAddHabit" title="Ajouter une habitude">‚ûï</button></h3>
      <div class="card habit-tracker-card">
        <div class="add-habit-form" x-show="showAddHabit" x-transition>
          <input type="text" x-model="newHabit.name" placeholder="Nom de l'habitude" class="input-field" @keyup.enter="addHabit()">
          <select x-model="newHabit.icon" class="icon-select">
            <option value="‚úÖ">‚úÖ</option>
            <option value="üí™">üí™</option>
            <option value="üìñ">üìñ</option>
            <option value="üíß">üíß</option>
            <option value="üßò">üßò</option>
            <option value="üèÉ">üèÉ</option>
            <option value="üçé">üçé</option>
            <option value="üí§">üí§</option>
            <option value="‚úçÔ∏è">‚úçÔ∏è</option>
            <option value="üéØ">üéØ</option>
          </select>
          <button class="btn primary" @click="addHabit()">Ajouter</button>
        </div>

        <div class="habits-list" x-show="habits.length">
          <div class="habit-row habit-header">
            <div class="habit-name-col"></div>
            <template x-for="day in getLast7Days()" :key="day.date">
              <div class="habit-day-col" :class="{ 'today': day.isToday }">
                <span class="day-name" x-text="day.dayName"></span>
                <span class="day-num" x-text="day.dayNum"></span>
              </div>
            </template>
            <div class="habit-streak-col">Streak</div>
          </div>

          <template x-for="habit in habits" :key="habit.id">
            <div class="habit-row">
              <div class="habit-name-col">
                <span class="habit-icon" x-text="habit.icon"></span>
                <span class="habit-name" x-text="habit.name"></span>
                <button class="btn-icon habit-delete" @click="removeHabit(habit.id)" title="Supprimer">‚úï</button>
              </div>
              <template x-for="day in getLast7Days()" :key="day.date">
                <div class="habit-day-col">
                  <button
                    class="habit-check"
                    :class="{ 'done': isHabitDone(habit.id, day.date) }"
                    @click="toggleHabitDay(habit.id, day.date)"
                  >
                    <span x-show="isHabitDone(habit.id, day.date)">‚úì</span>
                  </button>
                </div>
              </template>
              <div class="habit-streak-col">
                <span class="habit-streak" x-text="getHabitStreak(habit.id)"></span>üî•
              </div>
            </div>
          </template>
        </div>

        <p x-show="!habits.length && !showAddHabit" class="empty-habits">
          Aucune habitude. Cliquez sur ‚ûï pour en ajouter.
        </p>
      </div>
      </div>

      <div x-show="!focusMode">
      <h3>Spotify</h3>
      <div class="card spotify-card">
        
        <div x-show="!spotify.connected && !spotify.error.includes('not configured')">
          <p style="margin-bottom: 15px;">Connectez-vous √† Spotify pour voir votre musique en cours.</p>
          <button @click="spotifyLogin()" class="primary">Se connecter √† Spotify</button>
        </div>

        
        <div x-show="spotify.error.includes('not configured')" class="empty">
          <p>Spotify non configur√©. Ajoutez vos identifiants API dans le fichier <code>.env</code>.</p>
        </div>

        
        <div x-show="spotify.connected">
          
          <div x-show="spotify.track" class="spotify-player">
            <img
              x-show="spotify.track?.album_art"
              :src="spotify.track?.album_art"
              alt="Album Art"
              class="spotify-album-art"
            />
            <div class="spotify-info">
              <div class="spotify-track" x-text="spotify.track?.track_name"></div>
              <div class="spotify-artist" x-text="spotify.track?.artist_name"></div>
              <div class="spotify-album" x-text="spotify.track?.album_name"></div>
              <div class="spotify-progress">
                <span x-text="formatTime(spotify.track?.progress_ms)"></span>
                <span class="text-muted"> / </span>
                <span x-text="formatTime(spotify.track?.duration_ms)"></span>
              </div>
            </div>
          </div>

          
          <div x-show="!spotify.track" class="empty" style="margin-bottom: 15px;">
            Aucune musique en cours de lecture.
          </div>

          
          <div class="spotify-controls">
            <button @click="spotifyPrevious()" class="btn spotify-btn" title="Pr√©c√©dent">‚èÆÔ∏è</button>
            <button x-show="!spotify.track?.is_playing" @click="spotifyPlay()" class="primary spotify-btn" title="Lecture">‚ñ∂Ô∏è</button>
            <button x-show="spotify.track?.is_playing" @click="spotifyPause()" class="primary spotify-btn" title="Pause">‚è∏Ô∏è</button>
            <button @click="spotifyNext()" class="btn spotify-btn" title="Suivant">‚è≠Ô∏è</button>
            <button @click="spotifyLogout()" class="btn spotify-btn-small" title="D√©connexion" style="margin-left: auto;">Logout</button>
          </div>
        </div>
      </div>
      </div>
    </section>


    <section x-show="currentView === 'tasks'" x-transition:enter="view-enter" x-transition:leave="view-leave" class="view">
      <h2>Gestion des t√¢ches</h2>

      
      <form @submit.prevent="addTask()" class="toolbar task-form">
        <input
          x-model="newTask.title"
          type="text"
          placeholder="Nouvelle t√¢che‚Ä¶"
          required
          maxlength="200"
          class="grow"
        />
        <select x-model="newTask.priority">
          <option value="low">Low</option>
          <option value="normal" selected>Normal</option>
          <option value="high">High</option>
        </select>
        <input
          x-model="newTask.due_date"
          type="datetime-local"
          title="Date d'√©ch√©ance"
          style="width: 180px;"
        />
        <input
          x-model="newTask.tags"
          type="text"
          placeholder="Tags (ex: urgent, projet)"
          style="width: 150px;"
          title="Tags s√©par√©s par des virgules"
        />
        <select x-model="newTask.recurrence" title="R√©currence">
          <option value="">Pas de r√©currence</option>
          <option value="daily">Quotidien</option>
          <option value="weekly">Hebdomadaire</option>
          <option value="monthly">Mensuel</option>
        </select>
        <button type="submit" class="primary">Ajouter</button>
      </form>

      
      <div class="toolbar">
        <input 
          x-model="filters.q" 
          @input="debouncedLoadTasks()"
          type="search" 
          placeholder="Rechercher‚Ä¶"
          class="grow"
        />
        <select x-model="filters.status" @change="loadTasks()">
          <option value="">Tous statuts</option>
          <option value="todo">√Ä faire</option>
          <option value="doing">En cours</option>
          <option value="done">Termin√©es</option>
          <option value="archived">Archiv√©es</option>
        </select>
        <select x-model="filters.priority" @change="loadTasks()">
          <option value="">Toutes priorit√©s</option>
          <option value="low">Low</option>
          <option value="normal">Normal</option>
          <option value="high">High</option>
        </select>
        <select x-model="filters.tags" @change="loadTasks()" x-show="availableTags.length">
          <option value="">Tous tags</option>
          <template x-for="tag in availableTags" :key="tag">
            <option :value="tag" x-text="tag"></option>
          </template>
        </select>
        <select x-model="filters.sort" @change="loadTasks()">
          <option value="-created_at">Plus r√©centes</option>
          <option value="created_at">Plus anciennes</option>
          <option value="-priority">Priorit√© ‚Üì</option>
          <option value="priority">Priorit√© ‚Üë</option>
          <option value="title">Titre A-Z</option>
          <option value="-title">Titre Z-A</option>
        </select>
        <button 
          @click="bulkDelete()" 
          class="danger"
          :disabled="selectedTasks.length === 0"
        >
          Supprimer (<span x-text="selectedTasks.length"></span>)
        </button>
        <button @click="toggleTaskViewMode()" class="btn" title="Changer de vue">
          <span x-show="taskViewMode === 'list'">Kanban</span>
          <span x-show="taskViewMode === 'kanban'">Liste</span>
        </button>
      </div>

      
      <ul class="list" x-show="!loading.tasks && taskViewMode === 'list'">
        <template x-if="tasks.length === 0">
          <li class="empty">Aucune t√¢che trouv√©e.</li>
        </template>
        
        <template x-for="task in tasks" :key="task.id">
          <li class="task-item-wrapper">
            <div class="task-item">
              <input
                type="checkbox"
                class="task-checkbox"
                :checked="task.status === 'done'"
                @change="toggleTaskCompletion(task)"
                title="Marquer comme termin√©e"
              />
              <div class="task-main">
                <span class="task-title" x-text="task.title"></span>
                <div class="task-meta">
                  <span class="status-badge badge" :class="task.status" x-text="mapStatus(task.status)"></span>
                  <span class="badge" :class="task.priority" x-text="task.priority"></span>
                  <span x-show="task.due_date" class="due-date" :class="{ 'overdue': isOverdue(task), 'due-soon': isDueSoon(task) }">
                    <span x-text="formatDueDate(task.due_date)"></span>
                  </span>
                  <template x-for="tag in getTaskTags(task)" :key="tag">
                    <span class="tag" :class="getTagClass(tag)" x-text="tag"></span>
                  </template>
                  <span x-show="task.recurrence" class="recurrence-badge" :title="getRecurrenceLabel(task.recurrence)">
                    <span x-text="getRecurrenceLabel(task.recurrence)"></span>
                  </span>
                  <span x-show="task.subtasks?.length" class="subtask-count">
                    <span x-text="task.subtasks?.filter(s => s.status === 'done').length"></span>/<span x-text="task.subtasks?.length"></span>
                  </span>
                </div>
              </div>
              <div class="task-actions">
                <button @click="openAddSubtask(task)" class="btn" style="padding: 6px 10px;" title="Ajouter sous-t√¢che">
                  ‚ûï
                </button>
                <button @click="openEditTask(task)" class="btn" style="padding: 6px 10px;">
                  ‚úèÔ∏è
                </button>
                <button @click="deleteTask(task.id)" class="danger" style="padding: 6px 10px;">
                  üóëÔ∏è
                </button>
              </div>
            </div>
            <ul class="subtasks-list" x-show="task.subtasks?.length || addingSubtaskTo === task.id">
              <template x-for="subtask in task.subtasks" :key="subtask.id">
                <li class="subtask-item" :class="{ 'done': subtask.status === 'done' }">
                  <input
                    type="checkbox"
                    :checked="subtask.status === 'done'"
                    @change="toggleSubtaskStatus(subtask)"
                  />
                  <span class="subtask-title" x-text="subtask.title"></span>
                  <button @click="deleteTask(subtask.id)" class="btn-icon subtask-delete" title="Supprimer">‚úï</button>
                </li>
              </template>
              <li class="subtask-add-form" x-show="addingSubtaskTo === task.id">
                <input
                  type="text"
                  x-model="newSubtaskTitle"
                  @keyup.enter="addSubtask(task.id)"
                  @keyup.escape="closeAddSubtask()"
                  placeholder="Nouvelle sous-t√¢che..."
                  class="subtask-input"
                  x-ref="subtaskInput"
                />
                <button @click="addSubtask(task.id)" class="btn btn-sm">‚úì</button>
                <button @click="closeAddSubtask()" class="btn btn-sm">‚úï</button>
              </li>
            </ul>
          </li>
        </template>
      </ul>

      
      <div class="kanban-board" x-show="!loading.tasks && taskViewMode === 'kanban'">
        
        <div class="kanban-column"
             @dragover="onDragOver($event)"
             @dragenter="onDragEnter($event)"
             @dragleave="onDragLeave($event)"
             @drop="onDrop($event, 'todo')">
          <div class="kanban-header todo">
            <span>√Ä faire</span>
            <span class="kanban-count" x-text="getTasksByStatus('todo').length"></span>
          </div>
          <div class="kanban-items">
            <template x-for="task in getTasksByStatus('todo')" :key="task.id">
              <div class="kanban-card"
                   draggable="true"
                   @dragstart="onDragStart($event, task)"
                   @dragend="onDragEnd($event)">
                <div class="kanban-card-title" x-text="task.title"></div>
                <div class="kanban-card-meta">
                  <span class="badge" :class="task.priority" x-text="task.priority"></span>
                  <span x-show="task.recurrence" class="recurrence-badge-small" title="R√©current">üîÑ</span>
                  <span x-show="task.due_date" class="due-date" :class="{ 'overdue': isOverdue(task) }">
                    <span x-text="formatDueDate(task.due_date)"></span>
                  </span>
                  <template x-for="tag in getTaskTags(task)" :key="tag">
                    <span class="tag" :class="getTagClass(tag)" x-text="tag"></span>
                  </template>
                </div>
              </div>
            </template>
          </div>
        </div>


        <div class="kanban-column"
             @dragover="onDragOver($event)"
             @dragenter="onDragEnter($event)"
             @dragleave="onDragLeave($event)"
             @drop="onDrop($event, 'doing')">
          <div class="kanban-header doing">
            <span>En cours</span>
            <span class="kanban-count" x-text="getTasksByStatus('doing').length"></span>
          </div>
          <div class="kanban-items">
            <template x-for="task in getTasksByStatus('doing')" :key="task.id">
              <div class="kanban-card"
                   draggable="true"
                   @dragstart="onDragStart($event, task)"
                   @dragend="onDragEnd($event)">
                <div class="kanban-card-title" x-text="task.title"></div>
                <div class="kanban-card-meta">
                  <span class="badge" :class="task.priority" x-text="task.priority"></span>
                  <span x-show="task.recurrence" class="recurrence-badge-small" title="R√©current">üîÑ</span>
                  <span x-show="task.due_date" class="due-date" :class="{ 'overdue': isOverdue(task) }">
                    <span x-text="formatDueDate(task.due_date)"></span>
                  </span>
                  <template x-for="tag in getTaskTags(task)" :key="tag">
                    <span class="tag" :class="getTagClass(tag)" x-text="tag"></span>
                  </template>
                </div>
              </div>
            </template>
          </div>
        </div>


        <div class="kanban-column"
             @dragover="onDragOver($event)"
             @dragenter="onDragEnter($event)"
             @dragleave="onDragLeave($event)"
             @drop="onDrop($event, 'done')">
          <div class="kanban-header done">
            <span>Termin√©es</span>
            <span class="kanban-count" x-text="getTasksByStatus('done').length"></span>
          </div>
          <div class="kanban-items">
            <template x-for="task in getTasksByStatus('done')" :key="task.id">
              <div class="kanban-card"
                   draggable="true"
                   @dragstart="onDragStart($event, task)"
                   @dragend="onDragEnd($event)">
                <div class="kanban-card-title" x-text="task.title"></div>
                <div class="kanban-card-meta">
                  <span class="badge" :class="task.priority" x-text="task.priority"></span>
                  <span x-show="task.recurrence" class="recurrence-badge-small" title="R√©current">üîÑ</span>
                  <template x-for="tag in getTaskTags(task)" :key="tag">
                    <span class="tag" :class="getTagClass(tag)" x-text="tag"></span>
                  </template>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>

      <div x-show="loading.tasks" class="empty">
        <div class="spinner"></div> Chargement...
      </div>

      
      <div x-show="editingTask" class="modal-overlay" @click.self="closeEditTask()">
        <div class="modal">
          <div class="modal-header">
            <h3>Modifier la t√¢che</h3>
            <button @click="closeEditTask()" class="btn" style="padding: 5px 10px;">‚úï</button>
          </div>
          <form @submit.prevent="saveEditTask()" class="modal-body">
            <div class="form-group">
              <label>Titre</label>
              <input type="text" x-model="editingTask.title" required maxlength="200" />
            </div>
            <div class="form-group">
              <label>Description</label>
              <textarea x-model="editingTask.description" rows="3" maxlength="2000"></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Priorit√©</label>
                <select x-model="editingTask.priority">
                  <option value="low">Low</option>
                  <option value="normal">Normal</option>
                  <option value="high">High</option>
                </select>
              </div>
              <div class="form-group">
                <label>Statut</label>
                <select x-model="editingTask.status">
                  <option value="todo">√Ä faire</option>
                  <option value="doing">En cours</option>
                  <option value="done">Termin√©e</option>
                  <option value="archived">Archiv√©e</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>Date d'√©ch√©ance</label>
              <input type="datetime-local" x-model="editingTask.due_date" />
            </div>
            <div class="form-group">
              <label>Tags (s√©par√©s par des virgules)</label>
              <input type="text" x-model="editingTask.tags" placeholder="ex: urgent, projet, perso" />
            </div>
            <div class="form-group">
              <label>R√©currence</label>
              <select x-model="editingTask.recurrence">
                <option value="">Pas de r√©currence</option>
                <option value="daily">Quotidien</option>
                <option value="weekly">Hebdomadaire</option>
                <option value="monthly">Mensuel</option>
              </select>
            </div>
            <div class="modal-actions">
              <button type="button" @click="closeEditTask()" class="btn">Annuler</button>
              <button type="submit" class="primary">Enregistrer</button>
            </div>
          </form>
        </div>
      </div>
    </section>

    
    <section x-show="currentView === 'weather'" x-transition:enter="view-enter" x-transition:leave="view-leave" class="view">
      <h2>M√©t√©o <span x-text="weather.location" style="color: var(--muted);"></span></h2>
      
      <div class="card" x-show="weather.current.temp">
        <p style="font-size: 1.8rem; margin: 0;">
          <strong x-text="Math.round(weather.current.temp)"></strong>¬∞C
        </p>
        <p x-text="getWeatherDesc(weather.current.weathercode)" style="margin: 5px 0;"></p>
        <p style="color: var(--muted); font-size: 0.9rem;">
          Vent: <span x-text="Math.round(weather.current.windspeed)"></span> km/h
        </p>
      </div>

      <div x-show="loading.weather" class="card">
        <div class="spinner"></div> Chargement de la m√©t√©o...
      </div>

      <h3>Prochaines heure</h3>
      <div class="chips">
        <template x-for="h in weather.hourly.slice(0, 12)" :key="h.time">
          <span class="pill" x-text="`${new Date(h.time).toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})} ‚Ä¢ ${Math.round(h.temp)}¬∞C ‚Ä¢ ${getWeatherDesc(h.code)} ‚Ä¢ ${h.pop || 0}%`"></span>
        </template>
      </div>

      <h3>Prochains jours</h3>
      <div class="chips">
        <template x-for="d in weather.daily" :key="d.date">
          <span class="pill" x-text="`${new Date(d.date).toLocaleDateString('fr-FR', {weekday: 'short', day: 'numeric'})} ‚Ä¢ ${Math.round(d.tmin)}¬∞C‚Äì${Math.round(d.tmax)}¬∞C ‚Ä¢ ${getWeatherDesc(d.code)} ‚Ä¢ ${d.pop || 0}%`"></span>
        </template>
      </div>
    </section>

    
    <section x-show="currentView === 'hyperplanning'" x-transition:enter="view-enter" x-transition:leave="view-leave" class="view">
      <h2>Hyperplanning</h2>
      
      <div class="hp-grid">
        
        <div class="hp-column">
          <h3 x-text="'Emploi du temps (' + (hyperplanning.schedule.display_date || 'Aujourd\'hui') + ')'"></h3>
          <div class="card" x-show="hyperplanning.schedule.courses.length === 0">
            <p class="empty">Aucun cours pr√©vu pour cette date</p>
          </div>
          <div class="timeline">
            <template x-for="course in hyperplanning.schedule.courses" :key="course.id">
              <div class="timeline-item">
                <div class="timeline-time">
                  <span x-text="course.start"></span>
                  <span class="text-muted" x-text="course.end"></span>
                </div>
                <div class="timeline-content" :class="{'active': isCurrentCourse(course)}">
                  <div class="timeline-marker"></div>
                  <h4 x-text="course.subject"></h4>
                  <p class="location"><span x-text="course.room"></span></p>
                  <p class="teacher"><span x-text="course.teacher"></span></p>
                  <span class="badge" :class="course.type === 'TP' ? 'high' : 'normal'" x-text="course.type"></span>
                </div>
              </div>
            </template>
          </div>

          
          <div class="card" style="margin-top: 20px;">
            <h3>Prochains cours</h3>
            <ul class="list">
              <template x-for="course in hyperplanning.nextCourses" :key="course.id">
                <li class="grade-item"> 
                  <div class="grade-info">
                    <strong x-text="course.subject"></strong>
                    <div style="font-size: 0.85rem; color: var(--muted);">
                      <span x-text="new Date(course.raw_start).toLocaleDateString('fr-FR', {weekday: 'short', day: 'numeric', month: 'short'})"></span>
                      ‚Ä¢ 
                      <span x-text="course.start + (course.end ? ' - ' + course.end : '')"></span>
                    </div>
                  </div>
                  <div class="grade-value" style="font-size: 0.9rem; color: var(--text);">
                    <span x-text="course.room"></span>
                  </div>
                </li>
              </template>
            </ul>
            <div x-show="hyperplanning.nextCourses.length === 0" class="empty">
              Aucun cours √† venir.
            </div>
          </div>
        </div>

        
        <div class="hp-column">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3 style="margin: 0;">Derni√®res notes</h3>
            <button @click="hyperplanning.showImport = !hyperplanning.showImport" class="btn" style="font-size: 0.85rem; padding: 5px 10px;">
              <span x-show="!hyperplanning.showImport">Importer</span>
              <span x-show="hyperplanning.showImport">Fermer</span>
            </button>
          </div>

          
          <div x-show="hyperplanning.showImport" class="card" style="margin-bottom: 15px; background: var(--panel-hover);">
            <h4 style="margin-top: 0; font-size: 0.9rem;">Importer des notes (JSON)</h4>
            <p style="font-size: 0.8rem; color: var(--muted); margin-bottom: 10px;">
              Format: <code style="background: var(--bg); padding: 2px 5px; border-radius: 3px;">[{"subject": "Mati√®re", "date": "13 d√©c.", "value": 15.5}]</code>
            </p>
            <textarea
              x-model="hyperplanning.importInput"
              rows="6"
              placeholder='[
  {"subject": "Admin r√©seau", "date": "13 d√©c.", "value": 18.39},
  {"subject": "Anglais", "date": "9 d√©c.", "value": 14.50}
]'
              style="width: 100%; padding: 10px; background: var(--bg); color: var(--text); border: 1px solid var(--muted); border-radius: 5px; font-family: monospace; font-size: 0.85rem; resize: vertical;"
            ></textarea>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <button @click="importGrades()" class="primary" style="flex: 1;">Importer</button>
              <button @click="clearGrades()" class="danger">Tout supprimer</button>
            </div>
          </div>

          <div class="card">
            <ul class="list">
              <template x-for="grade in hyperplanning.grades" :key="grade.id">
                <li class="grade-item">
                  <div class="grade-info">
                    <strong x-text="grade.subject"></strong>
                    <small x-text="grade.date"></small>
                  </div>
                  <div class="grade-value" :class="getGradeColor(grade.value)">
                    <span x-text="grade.value"></span><span class="grade-max">/20</span>
                  </div>
                </li>
              </template>
            </ul>
            <div x-show="hyperplanning.grades.length === 0" class="empty">
              Aucune note. Cliquez sur "Importer" pour ajouter vos notes.
            </div>
          </div>

          <h3 style="margin-top: 20px;">Enseignements par mati√®re</h3>
          <div class="card">
            <div class="stats-grid" style="grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px;">
              <template x-for="stat in hyperplanning.stats" :key="stat.subject">
                <div class="stat-card" style="text-align: center; padding: 10px;">
                  <div class="stat-value" style="font-size: 1.2rem;" x-text="stat.done + 'h'"></div>
                  <div class="stat-label" style="font-size: 0.8rem; margin-bottom: 5px;" x-text="stat.subject"></div>
                  <div style="font-size: 0.7rem; color: var(--muted);">
                    Pr√©vu: <span x-text="stat.planned"></span>h
                  </div>
                </div>
              </template>
            </div>
            <div x-show="hyperplanning.stats.length === 0" class="empty">
              Chargement des statistiques...
            </div>
          </div>

          <h3 style="margin-top: 20px;">Acc√®s rapide</h3>
          <div class="card">
            <a href="https://extranet-hp-cgy.ensup.eu/hp-cgy/etudiant" target="_blank" class="hp-link">
              Ouvrir Hyperplanning (Extranet)
            </a>
          </div>
        </div>
      </div>
    </section>

    
    <section x-show="currentView === 'mail'" x-transition:enter="view-enter" x-transition:leave="view-leave" class="view">
      <h2>Proton Mail</h2>

      
      <div class="card" style="margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <span style="font-size: 2rem; font-weight: bold;" x-text="email.count ?? '?'"></span>
            <span style="color: var(--muted);"> email(s) non lu(s)</span>
          </div>
          <div style="display: flex; gap: 10px;">
            <button @click="email.showCompose = !email.showCompose" class="primary" style="padding: 8px 15px;">
              <span x-show="!email.showCompose">Nouveau</span>
              <span x-show="email.showCompose">Fermer</span>
            </button>
            <button @click="loadEmail()" class="btn" style="padding: 8px 15px;">
              Rafra√Æchir
            </button>
          </div>
        </div>
        <div x-show="email.error" style="margin-top: 10px; padding: 10px; background: var(--danger); border-radius: 5px;">
          ‚ö†Ô∏è <span x-text="email.error"></span>
        </div>
      </div>

      
      <div x-show="email.showCompose" class="card" style="margin-bottom: 20px; background: var(--panel-hover);">
        <h3 style="margin-top: 0;">Nouveau message</h3>
        <form @submit.prevent="sendEmail()" style="display: flex; flex-direction: column; gap: 15px;">
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">√Ä :</label>
            <input
              type="email"
              x-model="email.compose.to"
              placeholder="destinataire@exemple.com"
              required
              style="width: 100%; padding: 10px; background: var(--bg); color: var(--text); border: 1px solid var(--muted); border-radius: 5px;"
            />
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">Sujet :</label>
            <input
              type="text"
              x-model="email.compose.subject"
              placeholder="Sujet du message"
              required
              style="width: 100%; padding: 10px; background: var(--bg); color: var(--text); border: 1px solid var(--muted); border-radius: 5px;"
            />
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">Message :</label>
            <textarea
              x-model="email.compose.body"
              rows="8"
              placeholder="Votre message..."
              style="width: 100%; padding: 10px; background: var(--bg); color: var(--text); border: 1px solid var(--muted); border-radius: 5px; resize: vertical;"
            ></textarea>
          </div>
          <div style="display: flex; gap: 10px;">
            <button type="submit" class="primary" style="flex: 1;" :disabled="email.sending">
              <span x-show="!email.sending">Envoyer</span>
              <span x-show="email.sending">Envoi en cours...</span>
            </button>
            <button type="button" @click="email.compose = { to: '', subject: '', body: '' }" class="btn">
              Effacer
            </button>
          </div>
        </form>
      </div>

      
      <h3>Derniers emails non lus</h3>
      <div class="card">
        <ul class="list">
          <template x-for="mail in email.emails" :key="mail.id">
            <li class="email-item" @click="openEmail(mail)">
              <strong x-text="mail.subject"></strong>
              <div class="email-meta">
                <span x-text="mail.sender"></span>
                <small x-text="mail.date"></small>
              </div>
            </li>
          </template>
        </ul>
        <div x-show="email.emails.length === 0 && !email.error" class="empty">
          Aucun email non lu
        </div>
        <div x-show="email.error && email.emails.length === 0" class="empty">
          Impossible de charger les emails. V√©rifiez que Proton Bridge est lanc√©.
        </div>
      </div>

      <div x-show="email.selectedEmail" class="modal-backdrop" @click.self="closeEmail()">
        <div class="modal email-modal">
          <div class="modal-header">
            <h3 x-text="email.selectedEmail?.subject || 'Chargement...'"></h3>
            <button @click="closeEmail()" class="modal-close">&times;</button>
          </div>
          <div class="email-info">
            <div><strong>De:</strong> <span x-text="email.selectedEmail?.sender"></span></div>
            <div><strong>Date:</strong> <span x-text="email.selectedEmail?.date"></span></div>
          </div>
          <div class="email-body">
            <div x-show="email.loadingEmail" class="loading-spinner">Chargement...</div>
            <template x-if="!email.loadingEmail && email.selectedEmail?.html_body">
              <iframe :srcdoc="sanitizeEmailHtml(email.selectedEmail?.html_body)" class="email-iframe" sandbox="allow-same-origin"></iframe>
            </template>
            <template x-if="!email.loadingEmail && !email.selectedEmail?.html_body">
              <pre class="email-text" x-text="email.selectedEmail?.body || 'Aucun contenu'"></pre>
            </template>
          </div>
        </div>
      </div>

      
      <h3 style="margin-top: 20px;">Acc√®s rapide</h3>
      <div class="card">
        <a href="https://mail.proton.me" target="_blank" class="hp-link">
          Ouvrir Proton Mail (Web)
        </a>
      </div>

      
      <div class="card" style="margin-top: 20px; background: var(--panel-hover);">
        <h4 style="margin-top: 0;">Configuration requise</h4>
        <p style="font-size: 0.9rem; color: var(--muted);">
          Pour afficher vos emails, vous devez avoir <strong>Proton Bridge</strong> install√© et lanc√© sur votre PC.
          Les identifiants sont configur√©s dans le fichier <code>.env</code>.
        </p>
      </div>
    </section>

    <section x-show="currentView === 'analytics'" x-transition:enter="view-enter" x-transition:leave="view-leave" class="view">
      <h2>Statistiques de productivit√©</h2>

      <div class="analytics-summary">
        <div class="analytics-card">
          <div class="analytics-value" x-text="analytics.summary?.today_completed || 0"></div>
          <div class="analytics-label">Aujourd'hui</div>
        </div>
        <div class="analytics-card">
          <div class="analytics-value" x-text="analytics.summary?.week_completed || 0"></div>
          <div class="analytics-label">Cette semaine</div>
        </div>
        <div class="analytics-card">
          <div class="analytics-value" x-text="analytics.summary?.month_completed || 0"></div>
          <div class="analytics-label">Ce mois</div>
        </div>
        <div class="analytics-card">
          <div class="analytics-value" x-text="(analytics.summary?.completion_rate || 0) + '%'"></div>
          <div class="analytics-label">Taux global</div>
        </div>
      </div>

      <div class="charts-grid">
        <div class="chart-card">
          <h3>T√¢ches termin√©es (30 derniers jours)</h3>
          <div class="chart-container">
            <canvas id="dailyChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <h3>R√©partition par statut</h3>
          <div class="chart-container chart-small">
            <canvas id="statusChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <h3>R√©partition par priorit√©</h3>
          <div class="chart-container chart-small">
            <canvas id="priorityChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <h3>Tendance hebdomadaire</h3>
          <div class="chart-container">
            <canvas id="weeklyChart"></canvas>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top: 20px;">
        <h3>Statistiques d√©taill√©es</h3>
        <div class="stats-details">
          <div class="stat-row">
            <span>Temps moyen de compl√©tion:</span>
            <strong x-text="formatAvgTime(analytics.avgCompletionTime)"></strong>
          </div>
          <div class="stat-row">
            <span>Total de t√¢ches cr√©√©es:</span>
            <strong x-text="analytics.summary?.total_tasks || 0"></strong>
          </div>
          <div class="stat-row">
            <span>T√¢ches en retard:</span>
            <strong x-text="analytics.summary?.overdue || 0"></strong>
          </div>
        </div>
      </div>
    </section>


    <section x-show="currentView === 'settings'" x-transition:enter="view-enter" x-transition:leave="view-leave" class="view">
      <h2>Param√®tres</h2>

      <div class="card">
        <h3>Personnalisation</h3>

        <div style="margin-bottom: 20px;">
          <p style="font-weight: 500; margin-bottom: 10px;">Mode d'affichage</p>
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="btn" :class="{ 'primary': theme === 'dark' }" @click="theme = 'dark'; localStorage.setItem('theme', 'dark'); applyTheme();">
              Sombre
            </button>
            <button class="btn" :class="{ 'primary': theme === 'light' }" @click="theme = 'light'; localStorage.setItem('theme', 'light'); applyTheme();">
              Clair
            </button>
            <button class="btn" :class="{ 'primary': theme === 'auto' }" @click="theme = 'auto'; localStorage.setItem('theme', 'auto'); applyTheme();">
              Auto (syst√®me)
            </button>
          </div>
        </div>

        <div>
          <p style="font-weight: 500; margin-bottom: 10px;">Couleur d'accent</p>
          <div class="theme-picker">
            <template x-for="color in accentColors" :key="color">
              <button
                class="color-swatch"
                :class="[color, { 'active': accentColor === color }]"
                @click="setAccentColor(color)"
                :title="color"
              >
                <span x-show="accentColor === color">‚úì</span>
              </button>
            </template>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Sauvegarde des donn√©es</h3>
        <p style="color: var(--muted); margin-bottom: 16px;">
          Exportez vos donn√©es pour cr√©er une sauvegarde ou les transf√©rer vers un autre appareil.
        </p>
        <div class="export-import-buttons">
          <button class="btn btn-primary" @click="exportData()" :disabled="importExport.exporting">
            <span x-show="!importExport.exporting">Exporter</span>
            <span x-show="importExport.exporting">Export...</span>
          </button>
          <label class="btn btn-secondary import-label">
            <span x-show="!importExport.importing">Importer</span>
            <span x-show="importExport.importing">Import...</span>
            <input type="file" accept=".json" @change="importData($event)" style="display: none;" :disabled="importExport.importing">
          </label>
        </div>
        <p style="color: var(--muted); font-size: 0.85rem; margin-top: 12px;">
          ‚ö†Ô∏è L'import ajoutera les t√¢ches du fichier (les doublons possibles ne seront pas d√©tect√©s).
        </p>
      </div>

      <div class="card">
        <h3>Export PDF</h3>
        <p style="color: var(--muted); margin-bottom: 16px;">
          Exportez vos taches et notes rapides en PDF pour les imprimer ou les partager.
        </p>
        <div class="export-import-buttons">
          <button class="btn btn-primary" @click="exportTasksPDF()">
            Exporter les taches
          </button>
          <button class="btn btn-secondary" @click="exportNotesPDF()">
            Exporter les notes
          </button>
        </div>
      </div>

      <div class="card">
        <h3>Notifications</h3>
        <p style="color: var(--muted); margin-bottom: 16px;">
          Activez les notifications du navigateur pour recevoir des alertes Pomodoro.
        </p>
        <div class="export-import-buttons">
          <button class="btn" :class="{ 'btn-primary': notificationsEnabled, 'btn-secondary': !notificationsEnabled }" @click="toggleNotifications()">
            <span x-text="notificationsEnabled ? 'Notifications activees' : 'Activer les notifications'"></span>
          </button>
        </div>
        <p x-show="notificationsDenied" style="color: var(--danger); font-size: 0.85rem; margin-top: 12px;">
          ‚ö†Ô∏è Notifications bloquees par le navigateur. Modifiez les permissions dans les parametres du navigateur.
        </p>
      </div>

      <div class="card">
        <h3>Informations</h3>
        <p><strong>Version:</strong> 1.2.0</p>
        <p><strong>Mode:</strong> Local (SQLite)</p>
        <p><strong>API:</strong> <code x-text="API_BASE"></code></p>
        <hr style="border: 1px solid var(--border); margin: 20px 0;">
        <p style="color: var(--muted);">
          Nouvelles fonctionnalit√©s: th√®mes personnalisables, widgets r√©organisables, tests unitaires, linter ruff.
        </p>
      </div>
    </section>

  </main>

  <footer>
    <small>AutoDesk Kiwi v1.2.0</small>
  </footer>

  
  <script src="app.js"></script>
</body>
</html>